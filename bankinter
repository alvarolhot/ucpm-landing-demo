<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>UCPM Form Test</title>

  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body { margin: 0; background: #f6f7f9; }
    .wrap { max-width: 980px; margin: 0 auto; padding: 24px; }
    .card { background: #fff; border-radius: 12px; padding: 18px; margin: 18px 0; box-shadow: 0 2px 10px rgba(0,0,0,.06); }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 12px 0; }
    label { display: grid; gap: 6px; font-size: 14px; }
    input { padding: 10px 12px; border: 1px solid #d7dbe0; border-radius: 10px; font-size: 14px; }
    .checkbox { display: flex; align-items: center; gap: 8px; }
    .actions { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px; }
    button { padding: 10px 12px; border-radius: 10px; border: 1px solid #d7dbe0; background: #fff; cursor: pointer; }
    button:hover { background: #f2f4f7; }
    .muted { color: #6b7280; font-size: 13px; }
    .log { margin-top: 14px; border: 1px dashed #d7dbe0; border-radius: 12px; padding: 12px; background: #fafafa; }
    .log pre { margin: 0; white-space: pre-wrap; word-break: break-word; font-size: 12px; }
    .embedded-container { border: 1px solid #eef0f3; border-radius: 12px; padding: 12px; min-height: 120px; background: #fff; }

    @media (max-width: 720px) {
      .row { grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <main class="wrap">
    <h1>Test UCPM ‚Äì CMS form + Embedded form</h1>

    <section class="card">
      <h2>1) Formulario tipo CMS (custom)</h2>
      <p class="muted">
        Simula el formulario del cliente. Permite probar m√∫ltiples env√≠os y ver si el SDK se bloquea.
      </p>

      <form id="cmsForm">
        <div class="row">
          <label>Email
            <input id="email" type="email" required />
          </label>
          <label>Tel√©fono
            <input id="phone" type="tel" />
          </label>
        </div>

        <div class="row">
          <label>Nombre
            <input id="firstName" type="text" />
          </label>
          <label>Apellido
            <input id="lastName" type="text" />
          </label>
        </div>

        <div class="row">
          <label class="checkbox">
            <input id="marketing" type="checkbox" /> Marketing
          </label>
          <label class="checkbox">
            <input id="profiling" type="checkbox" /> Profiling
          </label>
        </div>

        <div class="actions">
          <button type="submit">Enviar lead</button>
          <button type="button" id="btnSubmit3">Enviar 3 veces</button>
          <button type="button" id="btnReset">Reset estado</button>
        </div>
      </form>

      <div class="log">
        <strong>Log de submits</strong>
        <pre id="log"></pre>
      </div>
    </section>

    <section class="card">
      <h2>2) Embedded Form UCPM</h2>
      <p class="muted">Aqu√≠ se renderiza el formulario est√°ndar de OneTrust.</p>

      <div id="ucpm-embedded-form" class="embedded-container"></div>

      <!-- üîΩ PEGA AQU√ç TU SCRIPT REAL üîΩ -->
      <script
        src="https://TU-DOMINIO.onetrust.com/consent-embedded-forms/consent-receipt-scripts/OtFormStub.js"
        data-id="TU-COLLECTION-POINT-ID"
        worker="https://consent-api.onetrust.com"
      ></script>
    </section>

    <p class="muted">
      Consejo: abre DevTools ‚Üí Network y filtra por "onetrust" o "consent" para ver los env√≠os reales.
    </p>
  </main>

<script>
(function () {
  const logEl = document.getElementById("log");
  const form = document.getElementById("cmsForm");
  const btnSubmit3 = document.getElementById("btnSubmit3");
  const btnReset = document.getElementById("btnReset");

  let submitCounter = 0;

  function log(text, obj) {
    const ts = new Date().toISOString();
    const msg = obj ? text + "\\n" + JSON.stringify(obj, null, 2) : text;
    logEl.textContent = "[" + ts + "] " + msg + "\\n\\n" + logEl.textContent;
    console.log(text, obj || "");
  }

  function getPayload() {
    return {
      email: email.value,
      phone: phone.value,
      firstName: firstName.value,
      lastName: lastName.value,
      marketing: marketing.checked,
      profiling: profiling.checked,
      clientSubmitId: crypto.randomUUID(),
      ts: Date.now()
    };
  }

  async function fakeSend(payload) {
    await new Promise(r => setTimeout(r, 300));
    return { ok: true };
  }

  async function handleSubmit(e) {
    e.preventDefault();
    submitCounter++;

    const payload = getPayload();
    log("SUBMIT #" + submitCounter, payload);

    if (submitCounter >= 3) {
      log("‚ö†Ô∏è Simulaci√≥n: a partir del 3¬∫ submit el SDK queda bloqueado");
      return;
    }

    const res = await fakeSend(payload);
    log("Resultado env√≠o (simulado)", res);
  }

  async function submitThreeTimes() {
    for (let i = 0; i < 3; i++) {
      await handleSubmit({ preventDefault() {} });
      await new Promise(r => setTimeout(r, 500));
    }
  }

  function resetState() {
    submitCounter = 0;
    log("Estado JS reseteado");
  }

  form.addEventListener("submit", handleSubmit);
  btnSubmit3.addEventListener("click", submitThreeTimes);
  btnReset.addEventListener("click", resetState);

  log("P√°gina lista para pruebas");
})();
</script>

</body>
</html>
